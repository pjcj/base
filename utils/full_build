#!/usr/bin/env zsh

# set -x

gobase() { cd ~/g/base || exit 1; }

gobase

source ~/.zplug/init.zsh
zplug clear
curl -SL https://github.com/docker/cli/raw/master/contrib/completion/zsh/_docker \
    >| ~/g/base/zsh/functions/_docker
curl -SL https://raw.githubusercontent.com/docker/compose/master/contrib/completion/zsh/_docker-compose \
    >| ~/g/base/zsh/functions/_docker-compose
curl -SL https://raw.githubusercontent.com/docker/machine/master/contrib/completion/zsh/_docker-machine \
    >| ~/g/base/zsh/functions/_docker-machine
curl -SL https://raw.githubusercontent.com/perlpunk/shell-completions/master/zsh/_dzil \
    >| ~/g/base/zsh/functions/_dzil
if [[ "$(uname)" == Darwin ]]; then
    curl https://raw.githubusercontent.com/zsh-users/zsh/master/Completion/Unix/Command/_git \
        >| ~/g/base/zsh/functions/_git
fi
rm -f ~/.zcompdump; autoload -Uz compinit && compinit -i

if [ -d ~/.tmux/plugins/tpm ]; then
    ~/.tmux/plugins/tpm/bindings/clean_plugins
    ~/.tmux/plugins/tpm/bindings/install_plugins
    ~/.tmux/plugins/tpm/scripts/update_plugin_prompt_handler.sh all
fi

if [[ "$(uname)" == Darwin ]]; then
    if [ ! which brew >&/dev/null ]; then
        /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    fi

    brew install        \
        bat             \
        coreutils       \
        ctags           \
        diff-so-fancy   \
        fzf             \
        fd              \
        git             \
        haskell-stack   \
        htop            \
        hub             \
        mutt            \
        neovim          \
        pigz            \
        ranger          \
        ripgrep         \
        thefuck         \
        tig             \
        tmux            \
        w3m             \
        wget            \
        xz              \
        zsh             \
        zsh-completions \
        zsh-git-prompt

    brew cask install                  \
        barrier                        \
        clementine                     \
        cyberduck                      \
        dropbox                        \
        font-inconsolata-for-powerline \
        google-chrome                  \
        iterm2                         \
        karabiner-elements             \
        sensiblesidebuttons            \
        sequel-pro                     \
        skype                          \
        slack                          \
        spotify                        \
        the-unarchiver                 \
        transmission                   \
        tunnelblick                    \
        vagrant                        \
        virtualbox                     \
        virtualbox-extension-pack

    brew update
    brew upgrade
    pip3=pip
elif [[ "$(uname)" == FreeBSD ]]; then
    sudo pkg install          \
        bat                   \
        diff-so-fancy         \
        fd-find               \
        fzf                   \
        highlight             \
        multitail             \
        neovim                \
        pigz                  \
        pixz                  \
        py36-pip              \
        py36-powerline-status \
        py36-ranger           \
        ripgrep               \
        thefuck               \
        tig                   \
        universal-ctags       \
        wget                  \
        zsh

    sudo pkg upgrade
    pip3=pip-3.6
else
    pip3=pip3
    sudo aptitude -y install golang python-pip

    $pip3 install --upgrade pip

    # sudo gem install colorls
    # sudo gem update colorls

    # urlwatch
    $pip3 install --upgrade --user pyyaml minidb requests keyring chump urlwatch

    $pip3 install --upgrade --user thefuck
fi

if [[ "$EDITOR" == "nvim" ]]; then
    $pip3 install --upgrade --user neovim
    $pip3 install --upgrade --user vim-vint proselint
    $pip3 install --upgrade --user git+git://github.com/powerline/powerline

    # denite
    $pip3 install --upgrade --user typing

    $EDITOR -c PlugUpgrade -c qa
    # $EDITOR -c PlugClean   -c qa
    $EDITOR -c PlugInstall -c qa
    $EDITOR -c PlugUpdate  -c qa

    $EDITOR -c UnicodeDownload -c qa
fi

if [[ $(uname) == Linux ]]; then
    gobase
    command go get -u github.com/motemen/ghq
    build_all
fi
